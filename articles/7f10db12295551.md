---
title: "RailsでTodoアプリを作る"
emoji: "💭"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["rails"]
published: false
---
RailsでTodoアプリを作ろうと思いましたので、その過程をここに記す。

このTodoアプリは、以下のような機能を持つ予定です。

- ユーザー登録・ログイン
- 複数のリスト（例：仕事、プライベート）を作成可能
- 各リストに複数のTodoを追加
- Todoの完了・未完了の管理
- リストの共有機能（URLを使って他のユーザーと共有）

この記事では、Railsでこのアプリをゼロから構築していく流れを段階的にまとめていきます。自分自身の学習記録も兼ねているので、細かいエラーや試行錯誤も記録していくつもりです。

## 開発環境

今回の開発環境は以下の通りです。

- **Ruby**: 3.2.3  
- **Rails**: 8.0.2  
- **エディタ**: Visual Studio Code  
- **バージョン管理**: Git（GitHubでソースコードを管理）

## プロジェクトの作成

まずは新しくRailsプロジェクトを作成します。

```bash
rails new todo_app
cd todo_app
```

Rails 8からは `propshaft` がデフォルトのアセットパイプラインになっていたりと、いくつか変更点がありますが、今回は標準設定のまま進めていきます。


## 開発用サーバーの起動確認

`todo_app` ディレクトリに移動したら、以下のコマンドで開発用サーバーを起動できます。

```bash
bin/rails server
```

実行すると、以下のようなログが表示されます：

```plaintext
=> Booting Puma
=> Rails 8.0.2 application starting in development 
=> Run `bin/rails server --help` for more startup options
Puma starting in single mode...
...
Use Ctrl-C to stop
```

ブラウザで `http://localhost:3000` にアクセスすると、Railsの初期ページが表示されれば成功です 🎉

> 💡 もし `ruby: No such file or directory -- rails` のようなエラーが出る場合は、`bin/rails` が生成されていない可能性があります。その場合は `bundle install` を実行してから、再度 `bin/rails server` を試してみてください。

了解！Zennのリンク先の記事のように、Railsの `primary_key` をUUIDやランダムな文字列にすることで、予測しにくいID設計にできますね。

記事の内容をベースに、`IdGenerateModule` を導入する流れをZenn記事内にまとめるなら、こんな感じで書けます：

---

## Listモデルの作成

### 主キーをランダムな文字列にする

デフォルトでは、Railsの主キー（`id`）は連番の整数ですが、今回はセキュリティやURLの美しさも考慮して、主キーをランダムな文字列に変更します。

以下の記事を参考に、ランダムIDを生成するモジュールを導入しました：  
https://zenn.dev/linkedge/articles/616c3884527769

### ID生成モジュールの定義

まず、以下のように `lib/id_generate_module.rb` を作成します：

```ruby
# lib/id_generate_module.rb
module IdGenerateModule
  extend ActiveSupport::Concern

  included do
    before_create :generate_id
    self.primary_key = 'id'
  end

  private

  def generate_id
    self.id ||= SecureRandom.urlsafe_base64(8)
  end
end
```

> 💡 `urlsafe_base64(8)` は長さ約11文字のランダムな文字列になります。用途に応じて長さを調整できます。


Todoを分類するための「リスト（List）」を作成します。`scaffold` コマンドを使うことで、モデル、ビュー、コントローラーがまとめて生成され、基本的なCRUD操作も一通りそろいます。

以下のコマンドを実行します：

```bash
rails g scaffold list title:string repeat_interval:string 
```

このコマンドにより、以下のようなファイルが自動生成されます：

- `app/models/list.rb`（モデル）
- `app/controllers/lists_controller.rb`（コントローラー）
- `app/views/lists/`（ビュー一式）
- `db/migrate/xxxxxxxxxxxxxx_create_lists.rb`（マイグレーションファイル）
- ルーティング設定（`config/routes.rb` に `resources :lists` が追加される）

### マイグレーションファイルの修正

主キーを文字列に変更するため、生成済みのマイグレーションファイルを修正します：

```ruby
# db/migrate/xxxx_create_lists.rb
class CreateLists < ActiveRecord::Migration[8.0]
  def change
    create_table :lists, id: :string, limit: 10 do |t|
      t.string :title
      t.string :repeat_interval

      t.timestamps
    end
  end
end

```

その後、マイグレーションを実行：

```bash
bin/rails db:migrate
```
### モデルに組み込む

たとえば `List` モデルでこのモジュールを使うには、以下のように記述します：

```ruby
# app/models/list.rb
class List < ApplicationRecord
  include IdGenerateModule

  validates :title, presence: true
end
```

### 動作確認

ブラウザから `/lists` にアクセスし、リストを新規作成すると、ランダムな文字列のIDが割り当てられていることが確認できます。


## ✅ Todoモデルの作成

まず、`Todo` モデルを作って、`List` に紐づけるようにします。`scaffold` でもいいですが、今回は必要なカラムだけ生成する `model` コマンドを使います：

```bash
bin/rails g model todo list:references content:string done:boolean
```

これにより以下のようなカラムを持つ `todos` テーブルが作られます：

- `list_id`: Listとの関連（外部キー）
- `content`: Todoの本文
- `done`: 完了済みかどうか（true/false）

---

## ✅ マイグレーション実行

```bash
bin/rails db:migrate
```

---

## ✅ モデルの関連付け

### Listモデル（親）

```ruby
# app/models/list.rb
class List < ApplicationRecord
  include IdGenerateModule

  has_many :todos, dependent: :destroy

  enum repeat_interval: {
    none: 'none',
    daily: 'daily',
    weekly: 'weekly',
    monthly: 'monthly'
  }, _default: :none

  validates :title, presence: true
end
```

### Todoモデル（子）

```ruby
# app/models/todo.rb
class Todo < ApplicationRecord
  belongs_to :list

  validates :content, presence: true
end
```

---

## ✅ ルーティングのネスト

リストごとのTodoなので、`routes.rb` ではネストさせます：

```ruby
# config/routes.rb
Rails.application.routes.draw do
  resources :lists do
    resources :todos
  end
end
```

---

## ✅ コントローラーとビューの生成

```bash
bin/rails g controller todos
```

ここからは、Todoの作成フォームを「リスト詳細ページ（`lists#show`）」に埋め込むスタイルにするのがシンプルでおすすめです。

---

## ✅ `lists#show` にフォームを追加（簡易的な形）

```erb
<!-- app/views/lists/show.html.erb -->

<h2>タスク一覧</h2>

<ul>
  <% @list.todos.each do |todo| %>
    <li>
      <%= todo.done? ? "✅" : "⬜" %>
      <%= todo.content %>
    </li>
  <% end %>
</ul>

<h3>新しいタスクを追加</h3>
<%= form_with model: [@list, Todo.new], local: true do |form| %>
  <div>
    <%= form.label :content %><br>
    <%= form.text_field :content %>
  </div>

  <div>
    <%= form.submit "追加" %>
  </div>
<% end %>
```

---

## ✅ `TodosController` の基本実装（createだけでOK）

```ruby
# app/controllers/todos_controller.rb
class TodosController < ApplicationController
  def create
    @list = List.find(params[:list_id])
    @todo = @list.todos.build(todo_params)

    if @todo.save
      redirect_to @list, notice: "タスクを追加しました"
    else
      render "lists/show", status: :unprocessable_entity
    end
  end

  private

  def todo_params
    params.require(:todo).permit(:content)
  end
end
```

---

これで「リストにTodoを追加できる」ようになります 🎉
